import {
  this.foreign {UINT32_MAX},
}

foreign {
  arc4random_uniform(int32): int32,
}

define random(ubound: int32): int {
  introspect os {
  | darwin =>
    zext-int32-int(magic external arc4random_uniform(ubound))
  | linux =>
    // requires glibc >= 2.36
    zext-int32-int(magic external arc4random_uniform(ubound))
  }
}

define random-in-range(lower-bound: int32, upper-bound: int32): int {
  let range-size = sub-int32(upper-bound, lower-bound) in
  let value = random(add-int32(range-size, 1)) in
  add-int(value, zext-int32-int(lower-bound))
}

define random-float(min: float, max: float): float {
  let numerator = random(UINT32_MAX) in
  let denominator = UINT32_MAX in
  add-float(
    min,
    mul-float(
      div-float(uitofp-int-float(numerator), uitofp-int32-float(denominator)),
      sub-float(max, min),
    ),
  )
}
