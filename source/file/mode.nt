import {
- this.list [list, fold-left]
}

data mode {
- Owner-R
- Owner-W
- Owner-X
- Group-R
- Group-W
- Group-X
- Other-R
- Other-W
- Other-X
}

define interpret-mode(flag: mode): int {
  introspect os {
  - darwin =>
    // https://github.com/apple/darwin-xnu/blob/main/bsd/sys/fcntl.h
    match flag {
    - Owner-R =>
      0o400
    - Owner-W =>
      0o200
    - Owner-X =>
      0o100
    - Group-R =>
      0o40
    - Group-W =>
      0o20
    - Group-X =>
      0o10
    - Other-R =>
      0o4
    - Other-W =>
      0o2
    - Other-X =>
      0o1
    }
  - linux =>
    // https://github.com/torvalds/linux/blob/master/include/uapi/linux/stat.h
    match flag {
    - Owner-R =>
      0o400
    - Owner-W =>
      0o200
    - Owner-X =>
      0o100
    - Group-R =>
      0o40
    - Group-W =>
      0o20
    - Group-X =>
      0o10
    - Other-R =>
      0o4
    - Other-W =>
      0o2
    - Other-X =>
      0o1
    }
  }
}

define interpret(xs: list(mode)): int {
  fold-left(0, xs, (acc, x) => {
    or-int(acc, interpret-mode(x))
  })
}

define default-file-mode(): list(mode) {
  [Owner-R, Owner-W, Group-R, Other-R] // 644
}

define default-directory-mode(): list(mode) {
  [Owner-R, Owner-W, Owner-X, Group-R, Group-X, Other-R, Other-X] // 755
}
