import {
- this.except {except, Fail}
- this.external {errno-location}
- this.memory {load-int32}
}

data errno {
- Errno(int)
}

define _get-errno(): int {
  let errno-ptr = errno-location() in
  load-int32(errno-ptr) // POSIX requires errno to be thread-safe
}

inline system(a: tau): tau {
  except(errno, a)
}

define report-error[a](): system(a) {
  Fail(Errno(_get-errno()))
}
