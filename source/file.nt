import {
- this.bool
- this.errno [Errno, get-errno, syscall]
- this.except [Pass, Fail]
- this.list [list]
- this.text [text, unsafe-get-content-pointer]
- this.unit [unit, Unit]
- FF
- FM
- FD
- ext
}

define open(path: &text, xs: list(FF.flag), ms: list(FM.mode)): syscall(FD.descriptor) {
  let path' = this.text.append(path, "\0") in
  let actual-path-string on path' = unsafe-get-content-pointer(path') in
  let fd = ext.open(actual-path-string, FF.interpret(xs), FM.interpret(ms)) in
  let _ = path' in
  if lt-int(magic cast(FD.descriptor, int, fd), 0) {
    Fail(Errno(get-errno()))
  } else {
    Pass(fd)
  }
}

define close(f: FD.descriptor): syscall(unit) {
  let result =  ext.close(f) in
  if eq-int(result, 0) {
    Pass(Unit)
  } else {
    Fail(Errno(get-errno()))
  }
}
