import {
  this.cell {mutate},
  this.control {discard},
  this.int.show {show-int},
  this.list {length, list},
  this.text,
  this.text.io {print, printf},
  this.unit {Unit, unit},
}

define with-cell(i: int): int {
  let c = new-cell(i) in
  let _ on c =
    mutate(c, function (x) {
      add-int(x, 1)
    })
  in
  let _ on c =
    mutate(c, function (x) {
      add-int(x, 1)
    })
  in
  let _ on c =
    mutate(c, function (x) {
      add-int(x, 1)
    })
  in
  let _ on c =
    mutate(c, function (x) {
      add-int(x, 21)
    })
  in
  this.cell.extract(c)
}

define box-int(i: int): meta int {
  magic cast(int, meta int, i)
}

define zen(): unit {
  let !xs: list(int) = [1, 2, 3] in
  letbox len on !xs = box-int(length(!xs)) in
  let _ = discard(!xs) in
  let _ = discard(!xs) in
  let _ = discard(!xs) in
  printf("len: {}\n", [show-int(len)]);
  print("hello, world\n");
  Unit
}

define main(): unit {
  zen()
}
